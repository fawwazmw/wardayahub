---
import BaseLayout from '../../layouts/BaseLayout.astro';
import PostCard from '../../components/blog/PostCard.astro';
import EmptyState from '../../components/blog/EmptyState.astro';
import ErrorState from '../../components/blog/ErrorState.astro';
import { getPosts } from '../../lib/blog';
import type { Post } from '../../types';

let posts: Post[] = [];
let error: string | null = null;
let pagination = null;

try {
  const result = await getPosts(1, 12);
  posts = result.posts;
  pagination = result.pagination;
} catch (e) {
  error = e instanceof Error ? e.message : 'Failed to load posts';
  console.error('Error loading posts:', e);
}

const siteDescription = import.meta.env.PUBLIC_SITE_DESCRIPTION || 'Blog posts';
---

<BaseLayout
  seo={{
    title: 'Blog - WardayaHub',
    description: siteDescription,
    type: 'website',
  }}
>
  <div class="blog-header">
    <h1>Blog</h1>
    <p class="subtitle">Discover our latest articles and insights</p>
  </div>

  {error ? (
    <ErrorState error={error} />
  ) : posts.length === 0 ? (
    <EmptyState message="No blog posts available yet." />
  ) : (
    <>
      <div class="posts-grid">
        {posts.map((post) => (
          <PostCard post={post} />
        ))}
      </div>

      {pagination && pagination.pageCount > 1 && (
        <div class="pagination">
          <p class="pagination-info">
            Showing page {pagination.page} of {pagination.pageCount}
          </p>
          <div class="pagination-actions">
            {pagination.page > 1 && (
              <a href={`/blog?page=${pagination.page - 1}`} class="btn-page">
                Previous
              </a>
            )}
            {pagination.page < pagination.pageCount && (
              <a href={`/blog?page=${pagination.page + 1}`} class="btn-page">
                Next
              </a>
            )}
          </div>
        </div>
      )}
    </>
  )}
</BaseLayout>

<style>
  .blog-header {
    text-align: center;
    margin-bottom: 3rem;
  }

  h1 {
    font-size: 2.5rem;
    margin: 0 0 0.5rem 0;
    color: #111;
  }

  .subtitle {
    font-size: 1.125rem;
    color: #666;
    margin: 0;
  }

  .posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
  }

  .pagination {
    text-align: center;
    padding: 2rem 0;
    border-top: 1px solid #e5e5e5;
  }

  .pagination-info {
    color: #666;
    margin-bottom: 1rem;
  }

  .pagination-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
  }

  .btn-page {
    padding: 0.75rem 2rem;
    background: white;
    color: #0066cc;
    border: 2px solid #0066cc;
    text-decoration: none;
    border-radius: 0.5rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-page:hover {
    background: #0066cc;
    color: white;
  }

  @media (max-width: 768px) {
    h1 {
      font-size: 2rem;
    }

    .posts-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
  }
</style>
